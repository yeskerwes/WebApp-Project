<!DOCTYPE html>
<html>
<head>
  <title>Profile</title>
  <link rel="stylesheet" href="/css/profile.css">
</head>
<body>

<header>
  <div class="container">
    <a href="/">Home</a>
    <a href="/products">Shop</a>
    <a href="/profile">Profile</a>
  </div>
</header>

<div class="container profile-page">

<% if (!user) { %>

  <div class="card profile-card">
    <h2>Welcome ðŸ‘‹</h2>
    <p>You are not logged in</p>

    <div class="actions">
      <a class="btn" href="/login">Login</a>
      <a class="btn secondary" href="/register">Register</a>
    </div>
  </div>

<% } else { %>

  <!-- ERROR MESSAGE -->
  <% if (typeof error !== 'undefined') { %>
    <div class="error-message" style="color: red; font-weight: bold; margin-bottom: 15px;">
      <%= error %>
    </div>
  <% } %>

  <div class="card profile-card">

    <!-- AVATAR -->
    <img
      class="avatar"
      src="<%= user.avatar
        ? `/avatar/${user.avatar}`
        : `https://api.dicebear.com/7.x/identicon/svg?seed=${user.username}` %>"
      alt="Avatar">

    <h2><%- user.username %></h2>
    <p><b>Role:</b> <%= user.role %></p>

    <!-- CHANGE AVATAR -->
    <form
      action="/profile/avatar"
      method="POST"
      enctype="multipart/form-data">

      <!-- FILE ONLY (SECURE) -->
      <input
        type="file"
        name="avatarFile"
        accept="image/png,image/jpeg,image/webp"
        required>

      <button class="btn">Save avatar</button>
    </form>

    <div class="card-info">
      <p class="label"><b>Card number</b></p>
      <p><%= user.card_number || 'â€”' %></p>
    </div>

    <a class="btn danger" href="/logout">Log out</a>
  </div>

<% } %>

</div>

</body>
</html>
